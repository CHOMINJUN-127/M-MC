<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap">
  <title>M&MC</title>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Roboto', sans-serif;
      background-color: #f5f5f5;
      min-height: 100vh;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .hidden {
      display: none;
    }
    
    h1{
      text-align: center;
      margin-top: 20px;
      font-size: 2.5rem;
      margin-bottom: 20px;
    }
    
    h1 span:nth-child(1) {
      color: #1B15B8;
    }

    button{
      background-color: #FFFFFF;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    button:hover {
      opacity: 0.8;
    }

    #menuToggle {
      position: fixed;
      top: 20px;
      left: 20px;
      background: none;
      border: none;
      padding: 8px;
      border-radius: 8px;
      z-index: 1001;
    }

    #menuToggle:hover {
      background-color: #f0f0f0;
    }

    .menu-icon {
      width: 26px;
      height: 24px;
      fill: #333;
    }
    
    .menu {
      position: fixed;
      top: 0;
      left: 0;
      width: 280px;
      height: 100vh;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      box-shadow: 2px 0 10px rgba(0,0,0,0.1);
      z-index: 1000;
      transform: translateX(-100%);
      transition: transform 0.3s ease;
    }

    .menu.show {
      transform: translateX(0);
    }

    .menu-content {
      padding-top: 60px;
      list-style: none;
    }

    .menu-content li {
      margin: 0;
    }

    .menu-content a {
      display: flex;
      align-items: center;
      padding: 15px 20px;
      color: white;
      text-decoration: none;
      transition: background-color 0.3s ease;
    }

    .menu-content a:hover {
      background-color: rgba(255,255,255,0.1);
    }

    .menu-icon-container {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      margin-right: 15px;
      font-size: 24px;
      flex-shrink: 0;
    }

    .menu-text {
      font-size: 16px;
      font-weight: 400;
      line-height: 1.2;
      flex: 1;
    }

    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 999;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .overlay.show {
      opacity: 1;
      visibility: visible;
    }

    .chat-container {
      max-width: 700px;
      margin: 0 auto;
      height: calc(100vh - 180px);
      background: white;
      border-radius: 15px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    #chatBox {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .message {
      display: flex;
      margin-bottom: 10px;
    }

    .message.user {
      justify-content: flex-end;
    }

    .message.ai {
      justify-content: flex-start;
    }

    .message-content {
      max-width: 70%;
      padding: 12px 16px;
      border-radius: 12px;
      line-height: 1.5;
      word-wrap: break-word;
    }

    .message.user .message-content {
      background-color: #4285f4;
      color: white;
      border-bottom-right-radius: 4px;
    }

    .message.ai .message-content {
      background-color: #f0f0f0;
      color: #333;
      border-bottom-left-radius: 4px;
    }

    .input-area {
      display: flex;
      gap: 10px;
      padding: 15px;
      border-top: 1px solid #ddd;
      background: white;
    }

    #chatInput {
      flex: 1;
      padding: 12px 15px;
      border: 1px solid #ddd;
      border-radius: 24px;
      font-size: 14px;
      font-family: 'Roboto', sans-serif;
      outline: none;
    }

    #chatInput:focus {
      border-color: #4285f4;
      box-shadow: 0 0 0 2px rgba(66, 133, 244, 0.1);
    }

    #sendBtn {
      padding: 8px 16px;
      background-color: #4285f4;
      color: white;
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    #sendBtn:hover {
      background-color: #3367d6;
    }

    .search-icon {
      width: 20px;
      height: 20px;
      fill: white;
    }

    .status-message {
      text-align: center;
      padding: 10px;
      border-radius: 5px;
      font-size: 14px;
      margin: 10px auto;
      max-width: 600px;
    }

    .status-success {
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .status-error {
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .loading {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .spinner {
      border: 2px solid #f3f3f3;
      border-top: 2px solid #4285f4;
      border-radius: 50%;
      width: 16px;
      height: 16px;
      animation: spin 1s linear infinite;
    }
  </style>

</head>
<body>
  <div class="overlay" id="overlay"></div>
  
  <h1>
    <span>M&MC</span>
  </h1>

  <!-- ìƒíƒœ ë©”ì‹œì§€ -->
  <div id="statusMessage" class="status-message" style="display: none;"></div>

  <!-- ì±„íŒ… ì»¨í…Œì´ë„ˆ -->
  <div class="chat-container">
    <div id="chatBox"></div>
    <div class="input-area">
      <input type="text" id="chatInput" placeholder="ê¶ê¸ˆí•œ ê²ƒì„ ì§ˆë¬¸í•˜ì„¸ìš”..." />
      <button id="sendBtn" type="button">
        <svg class="search-icon" viewBox="0 0 24 24">
          <path d="M16.6915026,16.4744748 L21.3818396,21.1601827 C21.6575604,21.4375722 21.6575604,21.8964725 21.3818396,22.1738619 C21.1124513,22.4512514 20.6616266,22.4512514 20.3922382,22.1738619 L15.7019012,17.4881539 C14.6214763,18.2624526 13.3563357,18.7193928 11.9779592,18.7193928 C9.05169437,18.7193928 6.68126019,16.3148986 6.68126019,13.3582393 C6.68126019,10.40158 9.05169437,8.00000000 11.9779592,8.00000000 C14.9042239,8.00000000 17.2746581,10.40158 17.2746581,13.3582393 C17.2746581,14.713393 16.8217172,15.9625016 16.0371496,16.9981408 C16.3065379,17.2755302 16.5426707,17.5432236 16.6915026,16.4744748 Z M11.9779592,16.5503556 C13.8914059,16.5503556 15.4657769,15.0 15.4657769,13.1272231 C15.4657769,11.2544462 13.8914059,9.70409497 11.9779592,9.70409497 C10.0645124,9.70409497 8.49014143,11.2544462 8.49014143,13.1272231 C8.49014143,15.0 10.0645124,16.5503556 11.9779592,16.5503556 Z"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- ì‚¬ì´ë“œë°” ë©”ë‰´ ë²„íŠ¼ -->
  <button id="menuToggle" type="button">
    <svg class="menu-icon" viewBox="0 0 24 24">
      <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
    </svg>
  </button>

  <!-- ì‚¬ì´ë“œë°” ë©”ë‰´ -->
  <div class="menu" id="sideMenu">
    <ul class="menu-content">
      <li><a href="#" onclick="location.href='123.html'">
        <span class="menu-icon-container">ğŸ </span>
        <span class="menu-text">Home</span>
      </a></li>
      <li><a href="#" onclick="location.href='test2.html'">
        <span class="menu-icon-container">ğŸ§ </span>
        <span class="menu-text">ë‡Œì¡¸ì¤‘</span>
      </a></li>
      <li><a href="#" onclick="location.href='test3.html'">
        <span class="menu-icon-container">ğŸ«</span>
        <span class="menu-text">íì•”</span>
      </a></li>
      <li><a href="#" onclick="location.href='test4.html'">
        <span class="menu-icon-container">ğŸ¤§</span>
        <span class="menu-text">íë ´</span>
      </a></li>
      <li><a href="#" onclick="location.href='test5.html'">
        <span class="menu-icon-container">â¤ï¸</span>
        <span class="menu-text">ì‹¬ì •ì§ˆí™˜</span>
      </a></li>
      <li><a href="#" onclick="location.href='test6.html'">
        <span class="menu-icon-container">ğŸ‘´</span>
        <span class="menu-text">ì•Œì¸ í•˜ì´ë¨¸</span>
      </a></li>
      <li><a href="#" onclick="location.href='test7.html'">
        <span class="menu-icon-container">ğŸ’‰</span>
        <span class="menu-text">ë‹¹ë‡¨ë³‘</span>
      </a></li>
      <li><a href="#" onclick="location.href='test8.html'">
        <span class="menu-icon-container">ğŸ†˜</span>
        <span class="menu-text">ìì‚´</span>
      </a></li>
      <li><a href="#" onclick="location.href='test9.html'">
        <span class="menu-icon-container">ğŸ’</span>
        <span class="menu-text">ê¸°ë¶€</span>
      </a></li>
       <!-- <li><a href="#" onclick="location.href='ë¡œê·¸ì•„ì›ƒ.html'">
        <span class="menu-icon-container">ğŸ—ï¸</span>
        <span class="menu-text">ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ</span>
      </a></li> -->
    </ul>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() { 
      // ë©”ë‰´ í† ê¸€ ê¸°ëŠ¥
      const menuToggle = document.getElementById('menuToggle');
      const menu = document.getElementById('sideMenu');
      const overlay = document.getElementById('overlay');

      function toggleMenu() {
        menu.classList.toggle('show');
        overlay.classList.toggle('show');
      }

      function closeMenu() {
        menu.classList.remove('show');
        overlay.classList.remove('show');
      }

      if (menuToggle && menu) {
        menuToggle.addEventListener('click', toggleMenu);
        overlay.addEventListener('click', closeMenu);
        
        document.addEventListener('keydown', function(e) {
          if (e.key === 'Escape' && menu.classList.contains('show')) {
            closeMenu();
          }
        });
      }

      // ì±„íŒ… ê¸°ëŠ¥
      const chatInput = document.getElementById('chatInput');
      const sendBtn = document.getElementById('sendBtn');
      const chatBox = document.getElementById('chatBox');
      const statusMessage = document.getElementById('statusMessage');

      function showStatus(message, isError = false) {
        statusMessage.textContent = message;
        statusMessage.className = `status-message ${isError ? 'status-error' : 'status-success'}`;
        statusMessage.style.display = 'block';
        setTimeout(() => {
          statusMessage.style.display = 'none';
        }, 3000);
      }

      function addMessage(text, isUser) {
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${isUser ? 'user' : 'ai'}`;
        
        const contentDiv = document.createElement('div');
        contentDiv.className = 'message-content';
        
        if (isUser) {
          contentDiv.textContent = text;
        } else {
          contentDiv.innerHTML = text;
        }
        
        messageDiv.appendChild(contentDiv);
        chatBox.appendChild(messageDiv);
        chatBox.scrollTop = chatBox.scrollHeight;
      }

      function addLoadingMessage() {
        const messageDiv = document.createElement('div');
        messageDiv.className = 'message ai';
        messageDiv.id = 'loadingMessage';
        
        const contentDiv = document.createElement('div');
        contentDiv.className = 'message-content loading';
        contentDiv.innerHTML = '<div class="spinner"></div> <span>M&MCê°€ ìƒê° ì¤‘ì…ë‹ˆë‹¤...</span>';
        
        messageDiv.appendChild(contentDiv);
        chatBox.appendChild(messageDiv);
        chatBox.scrollTop = chatBox.scrollHeight;
      }

      function removeLoadingMessage() {
        const loadingMsg = document.getElementById('loadingMessage');
        if (loadingMsg) {
          loadingMsg.remove();
        }
      }

      async function sendMessage() {
        const message = chatInput.value.trim();
        if (!message) {
          showStatus('ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”.', true);
          return;
        }

        addMessage(message, true);
        chatInput.value = '';
        addLoadingMessage();

        try {
          const response = await fetch('http://localhost:5000/ask', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Accept': 'application/json'
            },
            body: JSON.stringify({ query: message })
          });

          if (!response.ok) {
            throw new Error(`ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜: ${response.status}`);
          }

          const result = await response.json();
          removeLoadingMessage();

          if (result.success && result.result && result.result.answer) {
            addMessage(result.result.answer, false);
          } else {
            addMessage(`âŒ ì˜¤ë¥˜: ${result.message || 'ë‹µë³€ì„ ë°›ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'}`, false);
            showStatus(result.message || 'ë‹µë³€ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', true);
          }
        } catch (error) {
          removeLoadingMessage();
          console.error('ì—°ê²° ì˜¤ë¥˜:', error);
          addMessage(`ğŸ”Œ ì„œë²„ ì—°ê²° ì‹¤íŒ¨\n\nì˜¤ë¥˜: ${error.message}\n\ní•´ê²° ë°©ë²•:\n1. í„°ë¯¸ë„ì—ì„œ python ty.py ì‹¤í–‰\n2. ì„œë²„ê°€ http://localhost:5000 ì—ì„œ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸\n3. API í‚¤ê°€ ì˜¬ë°”ë¥´ê²Œ ì„¤ì •ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸`, false);
          showStatus('íŒŒì´ì¬ ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', true);
        }
      }

      sendBtn.addEventListener('click', sendMessage);
      chatInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          e.preventDefault();
          sendMessage();
        }
      });

      // í˜ì´ì§€ ë¡œë“œ ì‹œ ì„œë²„ ì—°ê²° í™•ì¸
      checkServerConnection();

      async function checkServerConnection() {
        try {
          const response = await fetch('http://localhost:5000/', {
            method: 'GET'
          });
          
          if (response.ok) {
            console.log('âœ… íŒŒì´ì¬ ì„œë²„ ì—°ê²° ì„±ê³µ');
            showStatus('âœ… ì„œë²„ì— ì„±ê³µì ìœ¼ë¡œ ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤');
          } else {
            throw new Error(`ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜: ${response.status}`);
          }
        } catch (error) {
          console.error('âŒ íŒŒì´ì¬ ì„œë²„ ì—°ê²° ì‹¤íŒ¨:', error);
          showStatus('âš ï¸ íŒŒì´ì¬ ì„œë²„ê°€ ì‹¤í–‰ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ty.pyë¥¼ ë¨¼ì € ì‹¤í–‰í•´ì£¼ì„¸ìš”.', true);
        }
      }
    });
  </script>
</body>
</html>